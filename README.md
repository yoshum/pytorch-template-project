# PyTorch Template Project

## 想定する実験環境

- 実験はDockerコンテナ内で実行する
  - 次のようなDockerコンテナを想定
    - ホストと同じUID/GID/ユーザー名を持つユーザー権限でプログラムを実行
    - コンテナ内にホームディレクトリ `/home/${USER}` を持つ
    - パスワードなしの `sudo` が可能
- Dockerホストはソースコードと同じマシン上かリモートホストのいずれかである
  - 多数の実験用計算機が使える環境では、単一の作業用マシンでコーディングをして、そのマシン上からリモートホストに実験を投げるような使い方を想定
  - ローカルにせよリモートにせよ、実験自体はDockerコンテナ内で実行

## ディレクトリ構造

### ホスト

リモートホストで実験を実行する場合は、実験開始時に `project_root/src` をローカルからリモートに同期する。
実験終了後に `project_root/results` をリモートからローカルへ同期する。
`project_root/data` は必要に応じて同期する。

```
project_root/
├── data/
├── results/
│   └── logdir/
└── src/
    ├── .git/
    ├── project_name/
    │   ├── datasets/
    │   ├── models/
    │   ├── pl_modules/
    │   ├── utils/
    │   └── __init__.py
    ├── scripts/
    │   └── train.py
    ├── Makefile
    ├── README.md
    └── requirements.txt
```

- `src/`
  - **このテンプレートプロジェクトの中身が設置される場所**
  - 実行時には対応するコンテナ内のパスをPYTHONPATHに設定する
  - Gitによりバージョン管理を実施する
- `src/project_name`
  - プロジェクトのモジュールを整理して配置する
  - 各ディレクトリに `__init__.py` を置いてパッケージとする
- `src/scripts`
  - 学習・評価等、実験のエントリーポイントとなるコードを配置する
- `src/Makefile`
  - 実験に関する様々な作業を `make` から実行できるようにしておく
  - `make` を打てばこのディレクトリで何ができるか分かる状態が理想
- `data/`
  - プロジェクト固有のデータセットのうち、サイズの小さいもの
  - サイズが大きいものは実行環境に応じて都合の良い場所に置く
  - Gitによるバージョン管理対象外
    - プログラムによって生成した場合は、その生成コードをsrc以下でバージョン管理する
- `results/`
  - 実験の結果をまとめておく
  - サブディレクトリの構造は実験ごとに設計する
  - Gitによるバージョン管理の対象外
    - 実験コードのバージョンと紐づけておく

### コンテナ

`(ホスト側のパス):(コンテナ側のパス)` によってホストのディレクトリをバインドすることを表す。

- `project_root:/workspace`
  - コンテナ内では、このテンプレートのファイル群が全て `/workspace/src` 以下にあると仮定してよい
    - より複雑な構造を持つプロジェクトが必要になったらその時に考える
  - ホストの `project_root/data` 以外のパスにデータセットが設置されている場合は、コンテナ内 `/workspace/data` 以下のサブディレクトリにバインド
- `/home/${USER}/docker/home:/home/${USER}`
  - Pretrained modelのパラメータ等、キャッシュをコンテナ間で再利用するため
  - データボリュームを用いる方がスマートかもしれない